<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/></head><body>fonction pour créer les graticules pour grille d'un map<br>decimal_to_dms &lt;- function(x, type) {<br>&nbsp; deg &lt;- floor(abs(x))<br>&nbsp; min &lt;- floor((abs(x) - deg) * 60)<br>&nbsp; sec &lt;- round((abs(x) - deg - min/60) * <a href="tel:3600">3600</a>, 1)<br>&nbsp; <br>&nbsp; dir &lt;- ifelse(type %in% c("N", "S"), <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ifelse(x &gt;= 0, "N", "S"),<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ifelse(x &gt;= 0, "E", "W"))<br>&nbsp; <br>&nbsp; paste0(deg, "° ", min, "' ", sec, '" ', dir)<br>}<br><br>graticules$degree_label &lt;- mapply(decimal_to_dms, graticules$degree, graticules$type)<br><br><br>create_graticule_map &lt;- function(bbox, lon_interval = 1, lat_interval = 1, <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; label_format = "decimal", buffer_dist = <a href="tel:0.2">0.2</a>) {<br>&nbsp; # Créer la zone d'étude<br>&nbsp; zone_etude &lt;- st_sfc(st_polygon(list(rbind(<br>&nbsp;&nbsp;&nbsp; c(bbox["xmin"], bbox["ymin"]),<br>&nbsp;&nbsp;&nbsp; c(bbox["xmax"], bbox["ymin"]),<br>&nbsp;&nbsp;&nbsp; c(bbox["xmax"], bbox["ymax"]),<br>&nbsp;&nbsp;&nbsp; c(bbox["xmin"], bbox["ymax"]),<br>&nbsp;&nbsp;&nbsp; c(bbox["xmin"], bbox["ymin"])<br>&nbsp; )), crs = <a href="tel:4326">4326</a>)<br>&nbsp; <br>&nbsp; # Générer les graticules<br>&nbsp; graticules &lt;- st_graticule(<br>&nbsp;&nbsp;&nbsp; ndiscr = <a href="tel:100">100</a>,<br>&nbsp;&nbsp;&nbsp; lon = seq(floor(bbox["xmin"]), ceiling(bbox["xmax"]), by = lon_interval),<br>&nbsp;&nbsp;&nbsp; lat = seq(floor(bbox["ymin"]), ceiling(bbox["ymax"]), by = lat_interval)<br>&nbsp; )<br>&nbsp; <br>&nbsp; # Appliquer le buffer<br>&nbsp; zone_buffer &lt;- st_buffer(st_convex_hull(zone_etude), dist = -buffer_dist)<br>&nbsp; graticules &lt;- st_intersection(graticules, zone_buffer)<br>&nbsp; <br>&nbsp; # Formater les labels selon le format choisi<br>&nbsp; if (label_format == "decimal") {<br>&nbsp;&nbsp;&nbsp; graticules$degree_label &lt;- paste0(graticules$degree, "°")<br>&nbsp; } else if (label_format == "symbol") {<br>&nbsp;&nbsp;&nbsp; graticules$degree_label &lt;- ifelse(graticules$type %in% c("E", "W"),<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; paste0(graticules$degree, "°", substr(graticules$type, 1, 1)),<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; paste0(graticules$degree, "°", substr(graticules$type, 1, 1)))<br>&nbsp; } else if (label_format == "dms") {<br>&nbsp;&nbsp;&nbsp; graticules$degree_label &lt;- mapply(decimal_to_dms, graticules$degree, graticules$type)<br>&nbsp; }<br>&nbsp; <br>&nbsp; # Créer la carte<br>&nbsp; p &lt;- ggplot() +<br>&nbsp;&nbsp;&nbsp; geom_sf(data = graticules, color = "gray80", linetype = "dashed") +<br>&nbsp;&nbsp;&nbsp; geom_sf(data = zone_etude, fill = NA, color = "black") +<br>&nbsp;&nbsp;&nbsp; theme_minimal()<br>&nbsp; <br>&nbsp; # Ajouter les labels sur les quatre côtés<br>&nbsp; if (nrow(graticules[graticules$type == "E",]) &gt; 0) {<br>&nbsp;&nbsp;&nbsp; p &lt;- p + geom_sf_text(data = graticules[graticules$type == "E",],<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; aes(label = degree_label), nudge_y = -<a href="tel:0.1">0.1</a>, size = 3)<br>&nbsp; }<br>&nbsp; if (nrow(graticules[graticules$type == "W",]) &gt; 0) {<br>&nbsp;&nbsp;&nbsp; p &lt;- p + geom_sf_text(data = graticules[graticules$type == "W",],<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; aes(label = degree_label), nudge_y = <a href="tel:0.1">0.1</a>, size = 3)<br>&nbsp; }<br>&nbsp; if (nrow(graticules[graticules$type == "N",]) &gt; 0) {<br>&nbsp;&nbsp;&nbsp; p &lt;- p + geom_sf_text(data = graticules[graticules$type == "N",],<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; aes(label = degree_label), nudge_x = <a href="tel:0.1">0.1</a>, size = 3)<br>&nbsp; }<br>&nbsp; if (nrow(graticules[graticules$type == "S",]) &gt; 0) {<br>&nbsp;&nbsp;&nbsp; p &lt;- p + geom_sf_text(data = graticules[graticules$type == "S",],<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; aes(label = degree_label), nudge_x = -<a href="tel:0.1">0.1</a>, size = 3)<br>&nbsp; }<br>&nbsp; <br>&nbsp; return(p)<br>}<br><br># Exemple d'utilisation<br>bbox &lt;- c(xmin = -5, ymin = 40, xmax = 10, ymax = 55)<br>create_graticule_map(bbox, lon_interval = 2, lat_interval = 2, label_format = "dms")</body></html>